# 未完成事项清单（Phase 0 收官版之后）

> 更新时间：2026-01-18  
> 范围：从 “Pre-Gymnasium Ready” 到 训练闭环 / 客户端落地 的演进路线

---

## 一、核心功能待开发项

### 1. Python 训练引擎（Phase 1）

- 优先级：高
- 目标：
  - 基于当前 Java Mod + Protobuf Socket 实现 Gymnasium 环境封装（如 `StsEnv`）。
  - 建立多进程采样框架（如 `SubprocVectorEnv` / 自定义并行管理器），对接 PPO / A2C 等算法实现。
  - 定义统一的观测空间与动作空间映射策略，确保与 `valid_actions` / `GameState` 字段严格对齐。
- 预计推进方向：
  - 在 `training-engine/envs/` 下创建环境封装模块，复用 `sts_state_pb2`。
  - 编写基础训练脚本（`scripts/train_ppo.py`），并预留超参数配置与实验记录目录。

### 2. Qt 决策客户端（Phase 2）

- 优先级：中
- 目标：
  - 使用 ONNX Runtime C++ API 加载已训练策略，完成本地单步推理。
  - 提供基础 UI 面板（当前状态 + 推荐动作），支持人类玩家与 AI 决策对比。
- 预计推进方向：
  - 在 `qt-decision-client/` 中补齐 CMake 工程骨架与依赖配置。
  - 确定与 Java Mod 的通信方式（沿用 Protobuf Socket 或本地管道）。

### 3. 大规模训练与评估工具链（Phase 3）

- 优先级：中
- 目标：
  - 构建多环境并行训练调度脚本，支持单机多进程与多机分布式两种模式。
  - 提供策略评估、对战基准（如与简单策略 / 人类玩家）以及指标可视化。
- 预计推进方向：
  - 在 `training-engine/experiments/` 中设计实验配置模板（YAML/JSON）。
  - 集成 TensorBoard 或自定义可视化组件，跟踪奖励曲线、胜率、平均通关层数等指标。

### 4. 云端策略中心与数据同步（Phase 4）

- 优先级：低
- 目标：
  - 在 `cloud-backend/` 中实现基础的策略上传 / 下发接口。
  - 支持训练日志与战斗回放数据的集中存储，为后续分析与分享提供基础设施。
- 预计推进方向：
  - 先实现最小可用 Flask 服务（策略列表 / 策略下载 / 上传接口）。
  - 后续接入数据库层（如 PostgreSQL 或 MongoDB）以支撑更复杂的检索与权限控制。

---

## 二、现有环境上的技术债与优化点

### 1. 精确结算分数与奖励信号

- 优先级：中
- 当前状态：
  - `GameOutcome.score` 采用基于楼层数与进阶等级的近似估分。
- 待办事项：
  - 深入分析 Slay the Spire 原版结算逻辑，找到稳定可访问的分数来源（或通过 AccessTransformer 暴露必要字段 / 方法）。
  - 调整协议与 Java 端填充值，使训练时使用的奖励与游戏实际得分尽量一致。

### 2. 商店与篝火信息完善

- 优先级：中
- 当前状态：
  - 协议层已为商品价格、篝火选项等信息预留字段，Java 侧由于访问权限限制部分以占位实现。
- 待办事项：
  - 引入 AccessTransformer 或类似机制，安全暴露价格与选项内容字段。
  - 在 `StsAIBridge` 中补全 Shop / Campfire 序列化逻辑，确保训练时可基于完整经济与事件决策信息进行学习。

### 3. 动作空间裁剪与合法性校验

- 优先级：中
- 当前状态：
  - 协议层已经支持多种动作（打出卡牌、结束回合、选择奖励、选择地图节点、RESET 等），但尚未在 Python 端实现统一的 `valid_actions` 剪枝策略。
- 待办事项：
  - 在 Gym 环境中实现动作合法性过滤与自动修正机制（非法动作 → no-op 或最近合法动作），减少策略早期的探索浪费。
  - 对典型场景（战斗 / 商店 / 篝火 / 地图）分别设计动作编码方案与测试用例。

### 4. 性能与稳定性优化

- 优先级：低
- 当前状态：
  - 单实例无头训练已满足基本需求，多实例场景尚未进行系统压测。
- 待办事项：
  - 使用 `tools/performance_test.py` 或新建脚本，评估多实例下的 CPU / 内存占用与延迟。
  - 根据压测结果优化采样频率、日志等级与 Socket 缓冲区大小，避免在极端并发下出现阻塞或死锁。

---

## 三、文档与工具链补全

### 1. Python 端使用文档

- 优先级：中
- 待办事项：
  - 在 `python_ai/README.md` 或 `training-engine/README.md` 中补充从 “启动无头实例 → 连接 Socket → 发送/接收 Protobuf 消息” 的完整示例。
  - 为 Gym 环境与训练脚本撰写最小可运行 Demo，降低二次接入成本。

### 2. 开发与 Debug 指南

- 优先级：低
- 待办事项：
  - 将当前开发日志与排障经验抽象为一份面向贡献者的 Debug 指南（如如何在 IntelliJ / VS Code 中设置断点、观察 GameState / ActionCommand 流动等）。
  - 结合 `docs/dev_logs/` 现有内容，沉淀一份从 “环境搭建 → 首次联调 → 性能调优” 的完整流程文档。

